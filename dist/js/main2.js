function y(e,t=document){if(!e)return;console.log("üé® Updating preview for cat:",e.name);const o=(r,p)=>{const g=t.querySelector(`.${r}`);g&&(g.src=p||"",g.style.display=p?"block":"none")};o("carouselBase",e.image),console.log("‚úÖ Base equipped:",e.image);const s=(r,p)=>{if(!p||!window.shopItems?.[r])return"";const g=window.shopItems[r].find(h=>h.id===p||h.template===p);return g||console.warn(`‚ùå Not found ‚Üí ${r}: ${p}`),g?.sprite_url||""},n=e.equipment?.hat,c=s("hats",n);o("carouselHat",c),c?console.log("‚úÖ Hat equipped:",c):console.log("‚ùå Hat unequipped");const d=e.equipment?.top,i=s("tops",d);o("carouselTop",i),i?console.log("‚úÖ Top equipped:",i):console.log("‚ùå Top unequipped");const u=e.equipment?.eyes,a=s("eyes",u);o("carouselEyes",a),a?console.log("‚úÖ Eyes equipped:",a):console.log("‚ùå Eyes unequipped");const m=e.equipment?.accessories?.[0],f=s("accessories",m);o("carouselAccessory",f),f?console.log("‚úÖ Accessory equipped:",f):console.log("‚ùå Accessory unequipped")}const K={hats:"hat",tops:"top",accessories:"accessories",eyes:"eyes"};function U(e,t,o){const s=o.ownedItems.map(String),n=String(e);return s.includes(n)?o.equippedItems[t]===e?"unequip":"equip":"buy"}function F(e,t){const o=U(e.id,e.category,t),s=K[e.category];if(console.log(`üõçÔ∏è handleShopClick | State: ${o}, Category: ${e.category}, ID: ${e.id}, Template: ${e.template}`),o==="buy")return t.coins>=e.price?(t.ownedItems.push(String(e.id)),t.coins-=e.price,console.log(`üí∞ Bought item: ${e.id}, new coin balance: ${t.coins}`),"bought"):(console.warn("‚ùå Not enough coins."),"not_enough");if(o==="equip"){t.equippedItems[e.category]=e.id,console.log(`üéΩ Equipped item: ${e.id} in category ${e.category}`),window.selectedCat.equipment||(window.selectedCat.equipment={}),s==="accessories"?window.selectedCat.equipment.accessories=[e.template]:window.selectedCat.equipment[s]=e.template,console.log("üê± Updated selectedCat.equipment:",JSON.stringify(window.selectedCat.equipment,null,2)),y(window.selectedCat);const n=document.querySelector(`.cat-card[data-cat-id="${window.selectedCat.id}"] .cat-thumbnail`);return n&&y(window.selectedCat,n),"equipped"}if(o==="unequip"){delete t.equippedItems[e.category],console.log(`üö´ Unequipped category: ${e.category}`),window.selectedCat.equipment&&(s==="accessories"?window.selectedCat.equipment.accessories=[]:delete window.selectedCat.equipment[s]),console.log("üê± After unequip, selectedCat.equipment:",JSON.stringify(window.selectedCat.equipment,null,2)),y(window.selectedCat);const n=document.querySelector(`.cat-card[data-cat-id="${window.selectedCat.id}"] .cat-thumbnail`);return n&&y(window.selectedCat,n),"unequipped"}return"noop"}const Y={coins:500,ownedItems:[],equippedItems:{hat:null,shoes:null,shirt:null,pants:null,accessories:null}};function X(){const e=localStorage.getItem("userItems");return e?JSON.parse(e):structuredClone(Y)}function j(e){localStorage.setItem("userItems",JSON.stringify(e))}function T(e){const t=document.querySelector(".coin-count");t&&(t.textContent=e)}window.updateCoinUI=T;function S(e,t){const o=document.getElementById("shopItems");if(!e||!o||!e[t])return;const s=e[t],n=X(),c=n.equippedItems?.[t],d=new Set(n.ownedItems||[]);o.innerHTML="",s.forEach(({name:i,sprite_url_preview:u,price:a,template:m})=>{const f=u,r=`${t}_${i.toLowerCase().replaceAll(" ","_")}`,p=U(r,t,n),g=p==="buy",h=document.createElement("div");h.className="shop-card",h.dataset.category=t,c===r?h.classList.add("equipped"):d.has(r)&&h.classList.add("owned"),h.innerHTML=`
      <img src="${f}" class="shop-img" alt="${i}" />
      <div class="${g?"shop-price-bar":"shop-btn-bar"}">
        ${g?`<img src="../assets/icons/coin.png" class="coin-icon" alt="coin" />
             <span>${a}</span>`:`<button class="shop-btn">${p.toUpperCase()}</button>`}
      </div>
    `;const B=g?h.querySelector(".shop-price-bar"):h.querySelector(".shop-btn");B.onclick=()=>{const O={id:r,name:i,price:a,category:t,template:m};if(g)Q(O,n,e,t);else{const C=F(O,n);j(n),T(n.coins);const A=window.selectedCat;if(A){const N=JSON.parse(localStorage.getItem("usercats")||"[]"),I=N.find(G=>G.id===A.id);I&&(I.equipment[t]=C==="equipped"?r:null,localStorage.setItem("usercats",JSON.stringify(N)),console.log(`üêæ ${I.name} now ${C} ${t}: ${I.equipment[t]}`))}(C==="equipped"||C==="unequipped")&&(Toastify({text:C==="equipped"?`Equipped "${i}"`:`Unequipped "${i}"`,duration:2e3,gravity:"bottom",position:"center",style:{background:"#2196f3"}}).showToast(),S(e,t))}},o.appendChild(h)})}function Q(e,t,o,s){const n=document.createElement("div");n.className="confirm-toast",n.innerHTML=`
    <div class="confirm-text">Buy "<b>${e.name}</b>" for ${e.price} coins?</div>
    <div class="confirm-buttons">
      <button class="yes-btn">Yes</button>
      <button class="no-btn">No</button>
    </div>
  `,document.body.appendChild(n),n.querySelector(".yes-btn").onclick=()=>{const c=F(e,t);j(t),T(t.coins),c==="bought"?(Toastify({text:`‚úÖ Bought "${e.name}"!`,duration:2e3,gravity:"bottom",position:"center",style:{background:"#4caf50"}}).showToast(),S(o,s)):c==="not_enough"&&Toastify({text:"‚ùå Not enough coins",duration:2e3,gravity:"bottom",position:"center",style:{background:"#d32f2f"}}).showToast(),n.remove()},n.querySelector(".no-btn").onclick=()=>{Toastify({text:"‚ùå Cancelled",duration:1500,gravity:"bottom",position:"center",style:{background:"#999"}}).showToast(),n.remove()}}function H(){console.log("üõí toggleShop() FORCE OPEN");const e=document.getElementById("shopPopup"),t=document.getElementById("catProfileScroll"),o=document.getElementById("shopOverlayBlocker");if(!e){console.warn("‚ùå shopPopup not found");return}if(t&&(t.style.display="none",t.classList.add("hidden"),console.log("üìú Profile scroll hidden")),o&&(o.classList.remove("hidden"),o.style.display="block",console.log("üõ°Ô∏è Blocker enabled")),e.style.display="block",e.classList.remove("hidden"),console.log("‚úÖ Shop popup shown"),document.body.classList.add("shop-lock"),window.shopItems){const n=document.querySelector(".tab.active")?.dataset.category?.toLowerCase()||"hats";S(window.shopItems,n)}else console.warn("‚ö†Ô∏è shopItems not loaded yet")}function Z(){const e=document.getElementById("shopPopup"),t=document.getElementById("catProfileScroll"),o=document.getElementById("shopOverlayBlocker");e&&(e.style.display="none",e.classList.add("hidden"),console.log("üõë Shop closed")),t&&(t.style.display="block",t.classList.remove("hidden"),console.log("üìú Profile scroll re-opened")),o&&(o.classList.add("hidden"),o.style.display="none",console.log("üßº Blocker disabled")),document.body.classList.remove("shop-lock")}const l=e=>document.getElementById(e),ee=e=>document.querySelectorAll(e);function w(e,t,o="block"){typeof e=="string"&&(e=l(e)),e&&(e.style.display=t?o:"none")}function te(){const e=l("mailbox");e.style.display=e.style.display==="block"?"none":"block"}const b={soundOn:!0,currentPage:0};function oe(){const e=l("volumeBtn"),t=e.textContent==="üîä";e.textContent=t?"üîá":"üîä",b.soundOn=!t}function ne(){localStorage.removeItem("loggedIn"),window.location.href="login.html"}async function se(){try{const t=await(await fetch(`${W}/api/user`,{credentials:"include"})).json();document.getElementById("welcomeMessage").textContent=`Welcome, ${t.username||"Guest"}`}catch{document.getElementById("welcomeMessage").textContent="Welcome, Guest"}}const ce="modulepreload",ie=function(e){return"/"+e},_={},le=function(t,o,s){let n=Promise.resolve();if(o&&o.length>0){let u=function(a){return Promise.all(a.map(m=>Promise.resolve(m).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const d=document.querySelector("meta[property=csp-nonce]"),i=d?.nonce||d?.getAttribute("nonce");n=u(o.map(a=>{if(a=ie(a),a in _)return;_[a]=!0;const m=a.endsWith(".css"),f=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${f}`))return;const r=document.createElement("link");if(r.rel=m?"stylesheet":ce,m||(r.as="script"),r.crossOrigin="",r.href=a,i&&r.setAttribute("nonce",i),document.head.appendChild(r),m)return new Promise((p,g)=>{r.addEventListener("load",p),r.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${a}`)))})}))}function c(d){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=d,window.dispatchEvent(i),!i.defaultPrevented)throw d}return n.then(d=>{for(const i of d||[])i.status==="rejected"&&c(i.reason);return t().catch(c)})},E=200,ae=96,D=5;function re(e){const t=l("catCarousel"),o=t.children.length,s=Math.ceil(o/D)-1;b.currentPage=Math.max(0,Math.min(b.currentPage+e,s));const n=b.currentPage*ae*D;t.style.transform=`translateX(-${n}px)`}function de(){const e=b.userCats?.length||0,t=document.getElementById("inventoryCount");t&&(t.textContent=`Inventory: ${e}/25`)}function ue(e,t,o={}){const s=document.createElement("div");s.className="cat-card",s.innerHTML=`
    <div class="cat-thumbnail">
      <div class="cat-bg"></div>
      <img id="carouselBase" class="cat-layer" />
      <img id="carouselHat" class="cat-layer" />
      <img id="carouselTop" class="cat-layer" />
      <img id="carouselEyes" class="cat-layer" />
      <img id="carouselAccessory" class="cat-layer" />
    </div>
    <span>${t}</span>
  `,y({name:t,image:e,equipment:o},s),s.onclick=()=>le(()=>Promise.resolve().then(()=>ye),void 0).then(c=>c.showCatProfile({name:t,image:e,equipment:o,breed:"-",variant:"-",palette:"-",birthday:"-",age:"-",description:""})),l("catCarousel").appendChild(s);const n=l("carouselCat");n.src=e,n.classList.remove("bounce-in"),n.offsetWidth,n.classList.add("bounce-in"),de()}function pe(){const e=ee(".tab");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(s=>s.classList.remove("active")),t.classList.add("active");const o=t.dataset.category.toLowerCase();S(window.shopItems,o)})}),e[0]&&e[0].click()}function me(e){document.getElementById("shopItems").scrollBy({left:e*160,behavior:"smooth"})}function R(e,t=null,o="block",s=null){const n=l(e),c=t?l(t):null;getComputedStyle(n).display===o||(w(n,!0,o),c&&e!=="shop"&&w(c,!0),s&&s.click())}function z(){R("uploadCat","uploadOverlay","flex")}function fe(){R("catProfileScroll",null,"block")}async function ge(){const e=l("catFileInput").files[0];if(!e)return alert("Pick a file first üôÇ");const t=new FormData;t.append("catImage",e);const o=await fetch(`${W}/api/cats`,{method:"POST",body:t});if(!o.ok)return alert("Upload failed");const{url:s,name:n}=await o.json();ue(s,n||"New Cat"),z()}function he(e){const t=e.target.files[0];t&&(l("uploadPreview").src=URL.createObjectURL(t),w("uploadActions",!0,"flex"))}const we=()=>l("catFileInput").click();function v(e){w("catProfile",!0,"flex"),w("catProfileScroll",!0);const t=l("catName"),o=l("catDesc"),s=l("charCount"),n=l("descBlock");l("profileBreed").textContent=e.breed,l("profileVariant").textContent=e.variant,l("profilePalette").textContent=e.palette,l("profileBirthday").textContent=e.birthday,l("profileAge").textContent=e.age,l("profileImage").src=e.image,t.value=e.name,t.disabled=!0,o.value=e.description,o.readOnly=!0,o.classList.remove("editing"),L(o),s.textContent=`${e.description.length} / ${E} characters`,n.classList.remove("editing"),window.currentCat=e}function J(){const e=l("editBtn"),t=l("saveBtn"),o=l("cancelBtn"),s=l("deleteBtn"),n=l("catName"),c=l("catDesc"),d=l("descBlock"),i=l("charCount");if(![e,t,o,s,n,c,d,i].every(Boolean)){console.warn("‚ö†Ô∏è setupEditMode aborted ‚Äî missing elements");return}c.addEventListener("input",()=>{L(c),i.textContent=`${c.value.length} / ${E} characters`}),e.addEventListener("click",()=>{n.dataset.original=n.value,c.dataset.original=c.value,n.disabled=!1,c.readOnly=!1,c.classList.add("editing"),d.classList.add("editing"),q({edit:!1,save:!0,cancel:!0}),L(c),console.log("‚úèÔ∏è Edit mode enabled")}),t.addEventListener("click",()=>{const u=n.value.trim(),a=c.value.trim();if(a.length>E){alert(`Description too long. Max: ${E} characters.`);return}if(window.currentCat){window.currentCat.name=u,window.currentCat.description=a;const m=document.querySelector(`.cat-card[data-cat-id="${window.currentCat.id}"]`);if(m){const f=m.querySelector("span");f&&(f.textContent=u)}}n.disabled=!0,c.readOnly=!0,c.classList.remove("editing"),d.classList.remove("editing"),q({edit:!0,save:!1,cancel:!1}),M("Changes saved!","#ffcc66"),console.log("üíæ Saved changes:",{name:u,desc:a})}),o.addEventListener("click",()=>{n.value=n.dataset.original,c.value=c.dataset.original,n.disabled=!0,c.readOnly=!0,c.classList.remove("editing"),d.classList.remove("editing"),q({edit:!0,save:!1,cancel:!1}),console.log("‚Ü©Ô∏è Edit canceled")}),s.addEventListener("click",()=>{if(console.log("üü° Delete button clicked"),!window.currentCat){console.warn("‚ö†Ô∏è No currentCat found. Aborting delete.");return}const u=document.createElement("div");u.innerHTML=`
      <div style="
        font-family: 'Press Start 2P', monospace;
        font-size: 14px;
        text-align: center;
      ">
        <img src="${window.currentCat.image}" alt="Cat Image"
          style="width: 96px; height: 96px; object-fit: contain; margin-bottom: 16px;" />
        <div style="margin-bottom: 16px;">Delete "<b>${window.currentCat.name}</b>"?</div>
        <button id="confirmDelete" style="margin-right:16px; font-size: 12px;">Yes</button>
        <button id="cancelDelete" style="font-size: 12px;">Cancel</button>
      </div>
    `;const a=window.Toastify({node:u,duration:-1,gravity:"top",position:"center",style:{background:"#d62828",border:"4px solid black",color:"white",padding:"32px",width:"420px",maxWidth:"90vw",fontSize:"16px",fontFamily:"'Press Start 2P', monospace",boxShadow:"8px 8px #000",textAlign:"center",zIndex:999999,position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"},callback:()=>{l("#confirmDelete")?.removeEventListener("click",m),l("#cancelDelete")?.removeEventListener("click",f)}});a.showToast();function m(){a.hideToast();const r=window.userCats.findIndex(B=>B.id===window.currentCat.id);if(r===-1)return;window.userCats.splice(r,1),w("catProfile",!1),w("catProfileScroll",!1),window.renderCarousel();let p=r-1;p<0&&(p=0);const g=window.userCats[p],h=document.getElementById("carouselCat");g?(v(g),h&&(h.src=g.image),w("catProfile",!0),w("catProfileScroll",!0)):h&&(h.src="../assets/cats/placeholder.png"),M("Cat deleted!","#ffcc66")}function f(){console.log("‚ùå Cancel button clicked"),a.hideToast()}requestAnimationFrame(()=>{const r=document.getElementById("confirmDelete"),p=document.getElementById("cancelDelete");r&&p?(r.addEventListener("click",m),p.addEventListener("click",f),console.log("‚úÖ Button events bound successfully")):console.warn("‚ùå Could not find confirm or cancel buttons in Toast")})})}function L(e){e.style.height="auto",e.style.height=e.scrollHeight+"px"}function q({edit:e,save:t,cancel:o}){const s=(n,c)=>{const d=l(n);d&&(d.style.visibility="visible",d.classList.toggle("hidden",!c))};s("editBtn",e),s("saveBtn",t),s("cancelBtn",o),s("deleteBtn",e),s("customizeBtn",e),s("fashionBtn",e)}function M(e,t){window.Toastify({text:e,duration:2e3,gravity:"top",position:"right",style:{background:t,border:"3px solid black",fontFamily:"'Press Start 2P', monospace",fontSize:"12px",color:"black",padding:"10px",zIndex:999999}}).showToast()}const ye=Object.freeze(Object.defineProperty({__proto__:null,setupEditMode:J,showCatProfile:v},Symbol.toStringTag,{value:"Module"}));function Ce(e){e("shopCloseBtn",Z,"üßº Close Shop clicked")}function be(e){e("customizeBtn",()=>{const t=window.selectedCat,o=t?.name||"Unknown";console.log(`üé® Force-opening shop for cat: ${o}`);const s=document.querySelector(`.cat-card[data-cat-id="${t?.id}"]`);s&&(document.querySelectorAll(".cat-card").forEach(c=>c.classList.remove("selected")),s.classList.add("selected")),H()})}function ve(e){e("fashionBtn",()=>{const t=window.selectedCat;if(!t||!t.id){console.warn("‚ùå No selected cat to enter fashion show");return}console.log(`üé≠ Entering Fashion Show with cat ID ${t.id}`),window.location.href=`fashion-show.html?catId=${t.id}`})}console.log("üê± MAIN.JS LOADED");let $=[],x=[];const W="https://catwalk-server.onrender.com";fetch("../data/usercats.json").then(e=>e.json()).then(e=>{$=e,window.userCats=$,V()}).catch(e=>console.error("‚ùå Failed to load usercats.json",e));fetch("../data/shopItems.json").then(e=>e.json()).then(e=>{x=e,window.shopItems=x,console.log("üõí Shop items loaded")}).catch(e=>console.error("‚ùå Failed to load shopItems.json",e));Object.assign(window,{toggleShop:H,renderShopItems:S,toggleMailbox:te,toggleVolume:oe,signOut:ne,scrollCarousel:re,scrollShop:me,uploadCat:ge,handleCatFileChange:he,triggerReupload:we,showCatProfile:v,toggleUploadCat:z,toggleDetails:fe,userCats:$,shopItems:x,renderCarousel:V,selectCatCard:P});document.addEventListener("DOMContentLoaded",()=>{console.log("‚úÖ DOMContentLoaded"),se(),pe(),J(),Se(),Ie(),console.log("‚úÖ Initialized systems")});function Se(){requestAnimationFrame(()=>{Ce(k),be(k),ve(k),console.log("‚úÖ Event listeners bound")})}function k(e,t,o=null){const s=document.getElementById(e);s?s.addEventListener("click",()=>{o&&console.log(o),t()}):console.warn(`‚ö†Ô∏è ${e} not found`)}function V(){const e=document.getElementById("catCarousel"),t=document.getElementById("catProfile"),o=document.getElementById("catProfileScroll");if(!e){console.warn("‚ùå catCarousel not found");return}if(console.log("üîÑ Rendering carousel with",window.userCats.length,"cats"),e.innerHTML="",window.userCats.forEach(i=>{const u=document.createElement("div");u.className="cat-card",u.dataset.catId=i.id,u.innerHTML=`
      <div class="cat-thumbnail" id="cardPreview_${i.id}">
        <div class="cat-bg"></div>
        <img class="cat-layer carouselBase" />
        <img class="cat-layer carouselHat" />
        <img class="cat-layer carouselTop" />
        <img class="cat-layer carouselEyes" />
        <img class="cat-layer carouselAccessory" />
      </div>
      <span>${i.name}</span>
    `;const a=u.querySelector(`#cardPreview_${i.id}`);y(i,a),u.addEventListener("click",()=>{const m=window.selectedCat?.id===i.id;window.selectedCat=i,P(u),v(i),console.log("üêæ Selected cat:",i.name),m||y(i)}),e.appendChild(u)}),window.userCats.length===0){console.log("‚ö†Ô∏è No cats to display");return}const s=window.userCats[0];window.selectedCat=s,y(s);const n=document.getElementById("carouselCat");n&&(n.src=s.image,n.alt=s.name||"Cat",console.log("üèÅ Podium cat set to:",s.name)),v(s);const c=document.querySelector(".cat-card");c&&(P(c),console.log("‚ú® First cat card selected")),t&&(t.style.display="flex"),o&&(o.style.display="block"),console.log("‚úÖ Profile made visible");const d=document.getElementById("inventoryCount");d&&(d.textContent=`Inventory: ${window.userCats.length}/25`,console.log("üì¶ Inventory updated:",window.userCats.length))}function P(e){document.querySelectorAll(".cat-card").forEach(t=>t.classList.remove("selected")),e.classList.add("selected")}function Ie(){const e=JSON.parse(localStorage.getItem("userItems"));if(!e){console.warn("‚ùå No userItems in storage");return}const t=document.querySelector(".coin-count");t?(t.textContent=e.coins,console.log(`ü™ô Coin count updated to ${e.coins}`)):console.warn("‚ùå .coin-count element not found")}export{W as A};
