import"./modulepreload-polyfill.js";let f=!1,h=0,g=null,l=null,v=[],o=null,s=[],r=null,u=null,p=60;const C=5;function q(){o=io(),o.on("connect",()=>{if(console.log("ðŸ”Œ Connected to fashion show server"),!l||!r)throw new Error("WS is created - but player-id or cat-id are missing");I()}),o.on("disconnect",()=>{console.log("ðŸ”Œ Disconnected from fashion show server")}),o.on("participant_update",e=>{console.log("ðŸ‘¥ Participant update:",e),A(e)}),o.on("voting_phase",e=>{console.log("ðŸ—³ï¸ Voting phase started:",e),L(e)}),o.on("voting_update",e=>{console.log("ðŸ—³ï¸ Voting update:",e),x(e)}),o.on("results",e=>{console.log("ðŸ† Results:",e),V(e)})}function I(){const e={type:"join",playerId:r,catId:l.id};console.log("ðŸ“¤ Sending join message:",e),o.emit("message",e)}function A(e){s=e.participants,N(s.length,e.maxCount);const t=s.find(n=>n.playerId===r);t&&(h=s.indexOf(t))}function L(e){s=e.participants,p=e.timerSeconds,k()}function x(e){s=e.participants,U()}function V(e){s=e.participants,f=!1,$(),u&&(clearInterval(u),u=null),Y()}function P(e){if(o&&o.connected){const t={type:"vote",votedCatId:e};console.log("ðŸ“¤ Sending vote:",t),o.emit("message",t)}}fetch("../data/usercats.json").then(e=>e.json()).then(e=>{v=e,window.userCats=v,l=v[Math.floor(Math.random()*v.length)],console.warn("Using stub cat-id "+l.id),console.log("ðŸ¾ Selected cat from album is:",l),r="player_"+Math.random().toString(36).substr(2,9),console.warn("Using stub player-id "+r),document.dispatchEvent(new Event("CatsReady"))}).catch(e=>{console.error("âŒ Failed to load usercats.json",e)});function N(e=1,t=C){const n=document.getElementById("player-counter");n&&(n.textContent=`${e}/${t}`)}function k(){const e=document.querySelector(".waiting-message");e&&(e.innerHTML="SETTING UP STAGE . . .",setTimeout(()=>{M()},1e3))}function M(){f=!0,document.querySelector(".waiting-message")?.remove(),R(),W()}function R(){const e=document.querySelector("main"),t=document.createElement("div");t.className="cat-display";for(let d=0;d<C;d++){const c=s[d],a=document.createElement("div");a.className="stage-base",a.setAttribute("data-cat-index",d),a.setAttribute("data-cat-id",c.catId);const y=document.createElement("img");y.src="../assets/icons/stage-walkway.png",y.alt="Stage Walkway",y.className="stage-walkway",a.appendChild(y);const m=document.createElement("img");m.className="cat-sprite",m.alt=`Cat ${c.catId}`,c.playerId===r&&l?m.src=l.image:m.src="../assets/cats/placeholder-fashion-show-cat.png",a.appendChild(m);const w=document.createElement("div");w.className="cat-name",w.textContent=`Cat ${c.catId}`,a.appendChild(w);const S=document.createElement("div");S.className="username",S.textContent=c.playerId===r?"You":c.playerId,a.appendChild(S),t.appendChild(a)}const n=document.createElement("div");n.className="announcement-text",n.textContent="HERE THEY COME!";const i=document.createElement("div");i.className="warning-message",i.textContent="You can't vote for your own cat, please vote for another cat",i.style.display="none",e.appendChild(t),e.appendChild(n),e.appendChild(i)}function B(){document.querySelector(".cat-display")?.classList.add("voting-active"),document.querySelectorAll(".stage-base").forEach((t,n)=>{t.addEventListener("click",()=>D(n)),t.addEventListener("mouseenter",()=>H(n)),t.addEventListener("mouseleave",()=>O(n))})}function $(){document.querySelector(".cat-display")?.classList.remove("voting-active"),E()}function D(e){if(!f||!s[e])return;if(e===h){j(e);return}E(),T(),document.querySelectorAll(".stage-base")[e]?.classList.add("selected");const n=s[e].catId;P(n)}function H(e){f&&e===h&&document.querySelectorAll(".stage-base")[e]?.classList.add("own-cat-hover")}function O(e){document.querySelectorAll(".stage-base")[e]?.classList.remove("own-cat-hover")}function j(e){T(),document.querySelectorAll(".stage-base")[e]?.classList.add("own-cat-selected");const t=document.querySelector(".warning-message");t&&(t.style.display="block"),g&&clearTimeout(g),g=setTimeout(E,3e3)}function E(){document.querySelector(".warning-message")?.style.setProperty("display","none"),document.querySelectorAll(".stage-base")[h]?.classList.remove("own-cat-selected"),clearTimeout(g),g=null}function T(){document.querySelectorAll(".stage-base").forEach(e=>e.classList.remove("selected"))}function U(){const e=s.filter(n=>n.votedCatId).length,t=document.querySelector(".announcement-text");t&&(t.textContent=`Waiting for all players to vote (${e}/${C})...`)}function W(){const e=document.querySelector(".announcement-text");setTimeout(()=>{e&&(e.textContent="VOTE!"),setTimeout(()=>{_(),z(),e&&(e.textContent=`Waiting for all players to vote (0/${C})...`),B(),F()},1e3)},2e3)}function _(){document.querySelector(".timer-section")?.style.setProperty("display","flex")}function z(){document.querySelector(".album-button")?.style.setProperty("bottom","120px")}function F(){b(),u=setInterval(()=>{p--,b(),p===10&&G(),p<=0&&(clearInterval(u),u=null,console.log("Voting time is up."))},1e3)}function b(){const e=document.getElementById("timer-text");e&&(e.textContent=`${p} s`)}function G(){const e=document.getElementById("timer-text");e&&(e.style.color="var(--color-red)",e.style.fontSize="var(--font-size-md)")}function Y(){const e=document.querySelector(".announcement-text");e&&(e.textContent="RESULTS!");const t=document.querySelector(".timer-section");t&&(t.style.display="none");const n=document.querySelectorAll(".stage-base");s.forEach((i,d)=>{const c=n[d];if(c){const a=document.createElement("div");a.className="cat-results",a.innerHTML=`
        <div class="votes-received">${i.votesReceived} votes</div>
        <div class="coins-earned">+${i.coinsEarned} coins</div>
      `,c.appendChild(a)}}),setTimeout(()=>{J()},3e3)}function J(){const e=document.querySelector("main"),t=document.createElement("div");t.className="play-again-options",t.innerHTML=`
    <button class="play-again-btn" onclick="playAgain()">Play Again</button>
    <button class="go-home-btn" onclick="goHome()">Go Home</button>
  `,e.appendChild(t)}document.addEventListener("CatsReady",()=>{console.log("Fashion Show page ready with selected cat"),q();const e=document.querySelector(".album-button");e&&e.addEventListener("click",t=>{f&&(t.preventDefault(),showExitDialog())})});window.addEventListener("beforeunload",()=>{o&&o.disconnect()});
